# Test Runner Permissions workflow
name: Test Runner Permissions

on:
  workflow_dispatch: # Manual trigger

jobs:
  test-permissions:
    name: Test what runner can do
    runs-on:
      - self-hosted
      - mac # Use our M1Max runner
    steps:
      - name: Test GitHub API access
        run: |
          echo "🔍 Testing GitHub API access from self-hosted runner..."
          echo "Current user:"
          curl -H "Authorization: Bearer $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github+json" \
               https://api.github.com/user || echo "❌ Failed to get user"

          echo -e "\n📋 Repository permissions:"
          curl -H "Authorization: Bearer $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github+json" \
               https://api.github.com/repos/jiripech/ta-cukrarna || echo "❌ Failed to get repo"

          echo -e "\n🏃 Runners list:"
          curl -H "Authorization: Bearer $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github+json" \
               https://api.github.com/repos/jiripech/ta-cukrarna/actions/runners || echo "❌ Failed to get runners"

          echo -e "\n🔐 Token info:"
          echo "GITHUB_TOKEN starts with: ${GITHUB_TOKEN:0:10}..."
          echo "GITHUB_TOKEN length: ${#GITHUB_TOKEN}"
